//——————————————————————————————————————————————————————————————————————————————
// Common Design: Main Navigation
//——————————————————————————————————————————————————————————————————————————————
.cd-nav__btn {
  height: $cd-site-header-height;

  &[aria-expanded] .cd-icon--arrow-down {
    fill: $implementation-highlight;
  }

  &[aria-expanded='true']  {
    &::before {
      background: $implementation-highlight;
    }
  }
}

.cd-site-header__nav-holder {
  // Active trail for mobile menu.
  @include max-width(lg) {
    .cd-nav > ul > li {
      > a.is-active::before,
      > button.is-active::before {
        background: $implementation-highlight;
      }

      // First level menu item with children.
      // Classes based on Drupal menu item configuration.
      &.menu-item--collapsed,
      &.menu-item--expanded {
        > a.is-active::before,
        > button.is-active::before {
          background: rgba($implementation-highlight, 0.2);
        }
      }

      &.menu-item--active-trail {
        a,
        button {
          &::before {
            background: rgba($implementation-highlight, 0.2);
          }

          &.is-active::before {
            background: $implementation-highlight;
          }
        }
      }

      > ul > li.menu-item--active-trail {
        a::before,
        button::before {
          background: rgba($implementation-highlight, 0.6);
        }

        a.is-active::before,
        button.is-active::before {
          background: $implementation-highlight;
        }
      }

    }
  }

  @include desktop {
    .cd-nav {
      height: $cd-site-header-height;
    }

    .cd-nav > ul {
      // @todo This should be put next to the place where the ul has its
      // display set to flex but I don't know where it is :'-(
      flex-wrap: nowrap;
    }

    .cd-nav > .menu {
      > .menu-item {
        &.menu-item--active-trail a::before,
        &.menu-item--active-trail button::before {
          background: $implementation-highlight;
        }

        > a,
        button {
          // @todo This should be put next to the place where the button has
          // its display set to flex but I don't know where it is :'-(
          justify-content: space-between;

          &.is-active,
          &:focus {
            // sass-lint:disable nesting-depth
            &::before {
              background: $implementation-highlight;
            }
          }

          .cd-icon {
            // Ensure the icons have a fixed width/height regardless of the
            // length of the button label.
            flex-grow: 0;
            flex-shrink: 0;
          }
        }
      }

      > li > ul {
        a,
        button {
          &.is-active {
            border-left: 3px solid $implementation-highlight;
          }
        }

        > li.menu-item--active-trail .is-active {
          border-left: 3px solid $implementation-highlight;
        }
      }
    }
  }
}

//——————————————————————————————————————————————————————————————————————————————
// GHO-4: RTL adjustments
//
// These need to be sent upstream once we're all happy with them.
//
// sass-lint:disable no-mergeable-selectors
//——————————————————————————————————————————————————————————————————————————————
.cd-site-header__nav-holder {
  @include desktop {
    .cd-nav > .menu {
      > .menu-item {
        [dir='rtl'] &:last-child {
          border-left: 1px solid $cd-border-color;
        }
      }

      > li > ul {
        a,
        button {
          &:hover {
            background: $cd-mid-bg-color;
          }

          [dir='rtl'] &.is-active {
            border-left: 0;
            border-right: 3px solid $cd-highlight-red;
          }
        }

        > li.menu-item--active-trail {
          a,
          button {
            [dir='rtl'] &.is-active {
              border-left: 0;
              border-right: 3px solid $cd-highlight-red;
            }
          }
        }
      }
    }
  }

  @include max-width(lg) {
    .cd-nav > ul > li {
      a,
      button {
        &::before {
          right: 15px; // Half of the horizontal padding.
        }
      }
    }
  }
}
